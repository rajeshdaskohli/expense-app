<!DOCTYPE html>
<html lang="hi" data-theme="dark">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>

<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root {
  --bg:#f8fafc; --card:#ffffff; --text:#0f172a; --text-dim:#64748b;
  --primary:#2563eb; --green:#10b981; --red:#ef4444; --border:rgba(0,0,0,0.05);
}
[data-theme="dark"] {
  --bg:#070b14; --card:#121826; --text:#f8fafc; --text-dim:#94a3b8;
  --primary:#38bdf8; --border:rgba(255,255,255,0.05);
}

*{box-sizing:border-box;transition:.3s}
body{margin:0;background:var(--bg);color:var(--text);font-family:'Plus Jakarta Sans';padding-bottom:100px}

.header{padding:20px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;background:var(--bg);z-index:100}

.container{max-width:500px;margin:auto;padding:0 16px}
.page{display:none}
.page.active{display:block}

.list-container{background:var(--card);border-radius:24px;padding:15px;margin-bottom:15px;border:1px solid var(--border)}

.inp{width:100%;padding:14px;margin-bottom:10px;border-radius:14px;border:1px solid var(--border);background:var(--bg);color:var(--text)}

.btn-main{width:100%;padding:16px;border:none;border-radius:16px;background:var(--primary);color:#fff;font-weight:800}

.nav-wrapper{position:fixed;bottom:20px;left:0;right:0;display:flex;justify-content:center}
.nav-bar{display:flex;background:var(--card);border-radius:24px;padding:6px;width:90%}
.nav-item{flex:1;text-align:center;padding:10px}
.nav-item.active{background:var(--primary);color:#fff;border-radius:18px}

.val-pos{color:var(--green)}
.val-neg{color:var(--red)}
</style>
</head>

<body>

<div class="header">
<h1>EXPENSE SEVA</h1>
<div>
<i class="material-icons-round" onclick="toggleTheme()">light_mode</i>
<i class="material-icons-round" onclick="refreshData()">sync</i>
</div>
</div>

<div class="container">

<!-- DASHBOARD -->
<div class="page active" id="pageDashboard">

<div class="list-container">
<h3>Credit Card Balances</h3>
<div id="cardList"></div>
</div>

<div class="list-container">
<h3>Add Credit Card Expense</h3>
<select id="expCard" class="inp"></select>
<input id="expAmt" type="number" class="inp" placeholder="Amount">
<input id="expCat" class="inp" placeholder="Category">
<input id="expRem" class="inp" placeholder="Remark">
<button class="btn-main" onclick="addExpense()">Save Expense</button>
</div>

<div class="list-container">
<h3>Bill Payment</h3>
<select id="payCard" class="inp"></select>
<input id="payAmt" type="number" class="inp" placeholder="Amount">
<button class="btn-main" onclick="addPayment()">Save Payment</button>
</div>

<div class="list-container">
<h3>Card to Card Transfer</h3>
<select id="fromCard" class="inp"></select>
<select id="toCard" class="inp"></select>
<input id="trAmt" type="number" class="inp" placeholder="Amount">
<button class="btn-main" onclick="addTransfer()">Transfer</button>
</div>

<div class="list-container">
<h3>Reports</h3>
<button class="btn-main" onclick="downloadPDF()">Download Monthly PDF</button>
</div>

</div>
</div>

<div class="nav-wrapper">
<div class="nav-bar">
<div class="nav-item active" onclick="showPage()">Home</div>
</div>
</div>

<script>

const API_URL = "YOUR_GOOGLE_SCRIPT_URL";

let db = null;

const fmt = n => new Intl.NumberFormat('en-IN',{style:'currency',currency:'INR'}).format(n||0);

function toggleTheme(){
let h=document.documentElement;
h.setAttribute('data-theme', h.getAttribute('data-theme')==='dark'?'light':'dark');
}

function showPage(){
document.getElementById("pageDashboard").classList.add("active");
}

async function refreshData(){

let res = await fetch(API_URL,{
method:"POST",
body:JSON.stringify({action:"getDashboard"})
}).then(r=>r.json());

if(res.ok){
db=res;
updateUI();
}
}

function updateUI(){

let list="";

for(let c in db.cards){
let v=db.cards[c];
list += `<div>${c} : <b class="${v>0?'val-neg':'val-pos'}">${fmt(v)}</b></div>`;
}

document.getElementById("cardList").innerHTML=list;

let opts="";
for(let c in db.cards){
opts += `<option value="${c}">${c}</option>`;
}

expCard.innerHTML = opts;
payCard.innerHTML = opts;
fromCard.innerHTML = opts;
toCard.innerHTML = opts;
}

async function addExpense(){

let data={
action:"saveExpense",
card_id:expCard.value,
amount:expAmt.value,
category:expCat.value,
remark:expRem.value
};

await fetch(API_URL,{
method:"POST",
body:JSON.stringify(data)
});

refreshData();
alert("Expense Saved");
}

async function addPayment(){

let data={
action:"savePayment",
card_id:payCard.value,
amount:payAmt.value
};

await fetch(API_URL,{
method:"POST",
body:JSON.stringify(data)
});

refreshData();
alert("Payment Saved");
}

async function addTransfer(){

let data={
action:"saveTransfer",
from_card:fromCard.value,
to_card:toCard.value,
amount:trAmt.value
};

await fetch(API_URL,{
method:"POST",
body:JSON.stringify(data)
});

refreshData();
alert("Transfer Done");
}

async function downloadPDF(){

let m = prompt("Enter Month Number (1-12)");

let res = await fetch(API_URL,{
method:"POST",
body:JSON.stringify({
action:"getMonthlyReport",
month:m,
year:new Date().getFullYear()
})
}).then(r=>r.json());

const { jsPDF } = window.jspdf;

let doc = new jsPDF();

doc.text("MONTHLY CREDIT CARD REPORT",20,20);

let y=40;

res.data.forEach(r=>{
doc.text(r[2]+" - "+r[5],20,y);
y+=10;
});

doc.save("Monthly_Report.pdf");
}

window.onload = refreshData;

</script>
</body>
</html>
