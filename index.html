<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Expense Manager</title>
  <style>
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: sans-serif; }
    body { margin: 0; background: #f4f4f4; padding: 15px; }
    .topbar { background: #111; color: #fff; padding: 15px; margin: -15px -15px 15px; font-weight: bold; }
    .grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
    .card { background: #fff; padding: 20px; border-radius: 15px; text-align: center; border: 1px solid #ddd; cursor: pointer; }
    .card:active { background: #eee; }
    .box { background: #fff; border-radius: 15px; padding: 15px; margin-bottom: 15px; border: 1px solid #ddd; }
    .inp { width: 100%; height: 45px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #ccc; padding: 10px; font-size: 16px; }
    .btn { width: 100%; height: 50px; background: #111; color: #fff; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; }
    .page { display: none; }
    .active { display: block; }
    .statRow { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee; }
    .val-neg { color: red; }
    .val-pos { color: green; }
  </style>
</head>
<body>

  <div class="topbar" id="pTitle">Home</div>

  <div class="container">
    <div class="page active" id="pageHome">
      <div class="grid2">
        <div class="card" onclick="showPage('sm')">üí∞ Expense Seva</div>
      </div>
    </div>

    <div class="page" id="pageSm">
      <div class="grid2">
        <div class="card" onclick="showPage('dashboard')">üìä Dashboard</div>
        <div class="card" onclick="showPage('entry')">‚úçÔ∏è Entry</div>
        <div class="card" onclick="showPage('addfund')">üè¶ Funds</div>
      </div>
    </div>

    <div class="page" id="pageDashboard">
      <div class="box">
        <b>Today: <span id="sToday">0</span> | Month: <span id="sMonth">0</span></b>
      </div>
      <div class="box">
        <b>üè¶ Banks & Cards</b>
        <div id="bankList"></div>
        <div id="cardList" style="margin-top:10px"></div>
      </div>
      <b>üïí History</b>
      <div id="historyList"></div>
    </div>

    <div class="page" id="pageEntry">
      <div class="box">
        <select class="inp" id="payMode" onchange="toggleE()">
          <option value="cash">Cash</option>
          <option value="bank">Bank</option>
          <option value="card">Card</option>
        </select>
        <div id="eB" style="display:none"><select class="inp" id="expBank"></select></div>
        <div id="eC" style="display:none"><select class="inp" id="expCard"></select></div>
        <input type="number" class="inp" id="expAmt" placeholder="Amount">
        <button class="btn" id="bSave" onclick="saveExp()">Submit</button>
      </div>
    </div>

    <div class="page" id="pageAddfund">
      <div class="box">
        <select class="inp" id="fAct" onchange="toggleF()">
          <option value="addfund">Deposit</option>
          <option value="cc">CC Bill</option>
          <option value="emi">EMI</option>
        </select>
        <select class="inp" id="tB"></select>
        <div id="fC" style="display:none"><select class="inp" id="tC"></select></div>
        <div id="fL" style="display:none"><select class="inp" id="tL"></select></div>
        <input type="number" class="inp" id="fAmt" placeholder="Amount">
        <button class="btn" onclick="procFund()">Process</button>
      </div>
    </div>
  </div>

  <script>
    const API_URL = "‡§Ü‡§™‡§ï‡§æ_‡§®‡§Ø‡§æ_URL_‡§Ø‡§π‡§æ‡§Å_‡§°‡§æ‡§≤‡•á‡§Ç";

    function showPage(id) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById('page' + id.charAt(0).toUpperCase() + id.slice(1)).classList.add('active');
      document.getElementById('pTitle').innerText = id.toUpperCase();
      if(id === 'dashboard' || id === 'entry' || id === 'addfund') fetchD();
    }

    function toggleE() {
      const m = document.getElementById("payMode").value;
      document.getElementById("eB").style.display = m==='bank'?'block':'none';
      document.getElementById("eC").style.display = m==='card'?'block':'none';
    }

    function toggleF() {
      const a = document.getElementById("fAct").value;
      document.getElementById("fC").style.display = a==='cc'?'block':'none';
      document.getElementById("fL").style.display = a==='emi'?'block':'none';
    }

    async function fetchD() {
      const res = await fetch(API_URL, {method:"POST", body:JSON.stringify({action:"getDashboard"})}).then(r=>r.json());
      if(res.ok) {
        const bH = res.banks.map(b=>`<option value="${b.name}">${b.name}</option>`).join("");
        document.getElementById("expBank").innerHTML = bH; document.getElementById("tB").innerHTML = bH;
        document.getElementById("expCard").innerHTML = res.cards.map(c=>`<option value="${c.name}">${c.name}</option>`).join("");
        document.getElementById("tC").innerHTML = document.getElementById("expCard").innerHTML;
        document.getElementById("tL").innerHTML = res.loans.map(l=>`<option value="${l.name}">${l.name}</option>`).join("");
        
        document.getElementById("sToday").innerText = "‚Çπ"+res.summary.todayExp;
        document.getElementById("sMonth").innerText = "‚Çπ"+res.summary.monthExp;
        document.getElementById("bankList").innerHTML = res.banks.map(b=>`<div class="statRow"><span>${b.name}</span><b>‚Çπ${b.balance}</b></div>`).join("");
        document.getElementById("cardList").innerHTML = res.cards.map(c=>`<div class="statRow"><span>${c.name}</span><b class="val-neg">‚Çπ${c.due}</b></div>`).join("");
        document.getElementById("historyList").innerHTML = res.summary.recentTrans.map(t=>`<div class="statRow"><span>${t.name}</span><b class="${t.type==='Add Fund'?'val-pos':'val-neg'}">‚Çπ${t.amount}</b></div>`).join("");
      }
    }

    async function saveExp() {
      const m = document.getElementById("payMode").value;
      const amt = document.getElementById("expAmt").value;
      let name = "Cash";
      if(m==='bank') name = document.getElementById("expBank").value;
      if(m==='card') name = document.getElementById("expCard").value;
      const res = await fetch(API_URL, {method:"POST", body: JSON.stringify({action:"save", type:m, name:name, amount:amt})}).then(r=>r.json());
      if(res.ok) { alert("Done!"); showPage('dashboard'); } else { alert(res.message); }
    }

    async function procFund() {
      const payload = {
        action: "processFund",
        fundAction: document.getElementById("fAct").value,
        amount: document.getElementById("fAmt").value,
        bankName: document.getElementById("tB").value,
        ccName: document.getElementById("tC").value,
        loanName: document.getElementById("tL").value
      };
      const res = await fetch(API_URL, {method:"POST", body: JSON.stringify(payload)}).then(r=>r.json());
      if(res.ok) { alert("Done!"); showPage('dashboard'); } else { alert(res.message); }
    }
  </script>
</body>
</html>
