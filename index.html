<!DOCTYPE html>
<html lang="hi" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
  <title>Finance Elite 360</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    :root {
      --bg: #030712; --surface: #111827; --input: #1f2937;
      --text: #f9fafb; --text-muted: #9ca3af; --border: rgba(255, 255, 255, 0.08);
      /* Exact Blue Gradient from your primary screenshot */
      --primary-grad: linear-gradient(135deg, #4f46e5 0%, #3b82f6 100%);
      --success: #10b981; --danger: #ef4444;
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Plus Jakarta Sans', sans-serif; padding-bottom: 120px; }
    .container { max-width: 500px; margin: 0 auto; padding: 0 16px; }

    /* Exact Screenshot Style Blue Net Worth Card */
    .hero-card { 
      background: var(--primary-grad); 
      border-radius: 35px; 
      padding: 30px 25px; 
      margin: 20px 0; 
      box-shadow: 0 15px 35px rgba(59, 130, 246, 0.2);
    }
    .hero-card small { 
      font-size: 13px; 
      opacity: 0.85; 
      font-weight: 500; 
      display: block;
      margin-bottom: 5px;
    }
    .hero-card h1 { 
      font-size: 40px; 
      margin: 5px 0 25px 0; 
      font-weight: 700; 
      letter-spacing: -1px;
    }
    .hero-stats { display: flex; gap: 10px; }
    .stat-pill {
      flex: 1;
      background: rgba(255, 255, 255, 0.12);
      padding: 12px;
      border-radius: 18px;
      text-align: center;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
    }

    /* Spending Source Bars - Flat Design from Screenshot */
    .spend-box { background: var(--surface); border-radius: 28px; padding: 22px; border: 1px solid var(--border); margin-bottom: 20px; }
    .spend-title { font-size: 11px; font-weight: 800; color:var(--text-muted); margin-bottom:18px; letter-spacing:1px; }
    .track-row { margin-bottom: 15px; }
    .track-info { display: flex; justify-content: space-between; font-size: 13px; font-weight: 600; margin-bottom: 8px; }
    .bar-bg { height: 8px; background: #1f2937; border-radius: 10px; overflow: hidden; }
    .bar-fill { height: 100%; border-radius: 10px; transition: 1s ease-in-out; }

    /* Bottom Navbar */
    .navbar { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 92%; height: 75px; background: rgba(17, 24, 39, 0.98); backdrop-filter: blur(20px); border-radius: 30px; border: 1px solid var(--border); display: flex; justify-content: space-around; align-items: center; z-index: 2000; }
    .nav-btn { color: var(--text-muted); text-align: center; flex: 1; font-size: 10px; font-weight: 700; cursor: pointer; }
    .nav-btn.active { color: #6366f1; }
    .nav-btn i { font-size: 24px; display: block; margin-bottom: 2px; }
    .nav-add { width: 58px; height: 58px; background: var(--primary-grad); border-radius: 50%; margin-top: -45px; display: flex; align-items: center; justify-content: center; color: white; border: 5px solid var(--bg); box-shadow: 0 8px 20px rgba(79, 70, 229, 0.3); }

    .page { display: none; }
    .page.active { display: block; }
    
    /* Transaction List Style */
    .log-item { background: var(--surface); padding: 18px; border-radius: 24px; border: 1px solid var(--border); margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
  </style>
</head>
<body>

  <div class="container">
    <div style="padding: 20px 0 5px; display: flex; justify-content: space-between; align-items: center;">
      <h2 style="margin:0; font-weight: 800; letter-spacing: -0.5px; font-size: 20px;">FINANCE 360</h2>
      <i class="material-icons-round" id="sync" onclick="refreshData()" style="cursor:pointer; color:var(--text-muted); font-size: 26px;">sync</i>
    </div>

    <div class="page active" id="page-home">
      <div class="hero-card">
        <small>Current Net Worth</small>
        <h1 id="netTotal">₹0</h1>
        <div class="hero-stats">
            <div class="stat-pill">Today: <span id="hToday">₹0</span></div>
            <div class="stat-pill">Month: <span id="hMonth">₹0</span></div>
        </div>
      </div>

      <div class="spend-box">
        <div class="spend-title">SPENDING BY SOURCE</div>
        <div class="track-row">
          <div class="track-info"><span>Bank Accounts</span><span id="txtExpBank">₹0</span></div>
          <div class="bar-bg"><div class="bar-fill" id="fillBank" style="background: #4f46e5; width:0%"></div></div>
        </div>
        <div class="track-row">
          <div class="track-info"><span>Credit Cards</span><span id="txtExpCard">₹0</span></div>
          <div class="bar-bg"><div class="bar-fill" id="fillCard" style="background: #ef4444; width:0%"></div></div>
        </div>
        <div class="track-row">
          <div class="track-info"><span>Cash / Wallet</span><span id="txtExpWallet">₹0</span></div>
          <div class="bar-bg"><div class="bar-fill" id="fillWallet" style="background: #10b981; width:0%"></div></div>
        </div>
      </div>
      
      <div id="accSummary"></div>
    </div>

    <div class="page" id="page-log">
        <h3 style="margin-left:10px; font-weight: 800;">Activity Log</h3>
        <div id="histList"></div>
    </div>
  </div>

  <div class="navbar">
    <div class="nav-btn active" onclick="nav('home')"><i class="material-icons-round">grid_view</i><span>Home</span></div>
    <div class="nav-btn" onclick="nav('move')"><i class="material-icons-round">swap_horiz</i><span>Move</span></div>
    <div class="nav-add" onclick="nav('add')"><i class="material-icons-round">add</i></div>
    <div class="nav-btn" onclick="nav('bills')"><i class="material-icons-round">receipt_long</i><span>Bills</span></div>
    <div class="nav-btn" onclick="nav('log')"><i class="material-icons-round">history</i><span>Log</span></div>
  </div>

  <script>
    const API = "https://script.google.com/macros/s/AKfycbxGwFBHXOgUTwgconAWDF0qZXPJwxtHc-TFwv-2Q_wHcZcGJtNg_i5JdNydifhP3BFBBA/exec";
    let db = null;

    function nav(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        const target = document.getElementById('page-'+id);
        if(target) target.classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    }

    async function refreshData() {
        document.getElementById('sync').classList.add('rotate');
        try {
            const r = await fetch(API, { method: "POST", body: JSON.stringify({action:"getDashboard"}) });
            db = await r.json();
            updateUI();
        } catch(e) { console.error(e); }
        document.getElementById('sync').classList.remove('rotate');
    }

    function updateUI() {
        if(!db) return;
        const fmt = (v) => "₹" + Math.abs(v).toLocaleString('en-IN');
        
        const bS = db.banks.reduce((a,b)=>a+Number(b.val),0);
        const cS = db.cards.reduce((a,b)=>a+Number(b.val),0);
        const lS = db.loans.reduce((a,b)=>a+Number(b.val),0);
        
        document.getElementById('netTotal').innerText = fmt((bS + db.walletBal) - (cS + lS));
        document.getElementById('hToday').innerText = fmt(db.summary.todayExp);
        document.getElementById('hMonth').innerText = fmt(db.summary.monthExp);

        // History UI
        document.getElementById('histList').innerHTML = db.summary.recentTrans.map(t => `
            <div class="log-item">
                <div><b>${t.category}</b><br><small style="color:var(--text-muted)">${t.name}</small></div>
                <b style="color:${t.type.includes('Income')?'#10b981':'#ef4444'}">${fmt(t.amount)}</b>
            </div>`).join('');
    }

    window.onload = refreshData;
  </script>
</body>
</html>
