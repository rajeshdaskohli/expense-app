<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@600;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  <style>
    :root { --bg: #0b1120; --card: #172033; --primary: #38bdf8; --text: #ffffff; }
    body { margin:0; background:var(--bg); color:var(--text); font-family: 'Plus Jakarta Sans', sans-serif; }
    
    .header { padding: 25px 20px; display: flex; justify-content: space-between; align-items: center; }
    .header h2 { margin:0; font-size: 18px; text-transform: uppercase; letter-spacing: 1px; }

    .page { display: none; padding: 0 20px; animation: fadeIn 0.3s; }
    .page.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* Cards - Exactly like your screenshot */
    .hero-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 25px; }
    .stat-card { padding: 20px; border-radius: 20px; color: white; }
    .stat-card h3 { margin:0; font-size: 10px; opacity: 0.8; text-transform: uppercase; }
    .stat-card h1 { margin: 5px 0 0; font-size: 22px; }

    .list-card { background: var(--card); border-radius: 24px; padding: 15px; margin-bottom: 20px; }
    .row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #ffffff0d; }
    .row:last-child { border: none; }

    /* Form Fields */
    .inp { width: 100%; background: #1e293b; border: 1px solid #334155; border-radius: 15px; padding: 15px; color: white; margin-top: 10px; font-size: 16px; outline: none; }
    .btn { width: 100%; background: var(--primary); color: #000; border: none; padding: 18px; border-radius: 18px; font-weight: 800; margin-top: 20px; font-size: 16px; }

    /* Bottom Nav Fix */
    .nav-bar { position: fixed; bottom: 15px; left: 5%; width: 90%; background: #1e293b; display: flex; border-radius: 25px; padding: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); z-index: 100; }
    .nav-item { flex: 1; text-align: center; color: #64748b; font-size: 10px; padding: 10px 0; cursor: pointer; transition: 0.3s; }
    .nav-item.active { color: var(--primary); background: rgba(56,189,248,0.1); border-radius: 20px; }
    .nav-item i { display: block; font-size: 24px; margin-bottom: 4px; }
  </style>
</head>
<body>

  <div class="header">
    <div><h2>Expense Seva Pro</h2><small style="color:#10b981">‚óè LIVE SYSTEM</small></div>
    <i class="material-icons-round" onclick="loadData()">sync</i>
  </div>

  <div id="p0" class="page active">
    <div class="hero-grid">
      <div class="stat-card" style="background:#f59e0b"><h3>Today</h3><h1 id="h-today">‚Çπ0</h1></div>
      <div class="stat-card" style="background:#ec4899"><h3>Month Exp</h3><h1 id="h-month">‚Çπ0</h1></div>
      <div class="stat-card" style="background:#10b981"><h3>Total Funds</h3><h1 id="h-funds">‚Çπ0</h1></div>
      <div class="stat-card" style="background:#3b82f6"><h3>Wallet Bal</h3><h1 id="h-wallet">‚Çπ0</h1></div>
    </div>
    <div style="font-size:12px; margin-bottom:10px; color:#94a3b8">RECENT ACTIVITY</div>
    <div class="list-card" id="h-history"></div>
  </div>

  <div id="p1" class="page">
    <div class="list-card">
      <h3>New Expense</h3>
      <select id="e-mode" class="inp" onchange="document.getElementById('e-bank-div').style.display=(this.value=='bank'?'block':'none')">
        <option value="cash">üíµ Cash</option>
        <option value="bank">üè¶ Bank</option>
      </select>
      <div id="e-bank-div" style="display:none"><select id="e-bank" class="inp"></select></div>
      <select id="e-cat" class="inp"></select>
      <input type="number" id="e-amt" class="inp" placeholder="Amount">
      <button class="btn" onclick="save('entry')">RECORD EXPENSE</button>
    </div>
  </div>

  <div id="p2" class="page">
    <div class="list-card">
      <h3>Transfer / Fund</h3>
      <label style="font-size:10px; color:var(--primary)">DEPOSIT TO</label>
      <select id="f-to" class="inp" onchange="updateFundFields()">
        <option value="Wallet">Wallet</option>
        <option value="Bank">Bank Account</option>
      </select>
      <div id="f-bank-div" style="display:none"><select id="f-bank" class="inp"></select></div>
      <label style="font-size:10px; color:var(--primary); margin-top:15px; display:block">SOURCE</label>
      <select id="f-src" class="inp"></select>
      <input type="number" id="f-amt" class="inp" placeholder="Amount">
      <button class="btn" onclick="save('fund')">CONFIRM TRANSFER</button>
    </div>
  </div>

  <div class="nav-bar">
    <div class="nav-item active" onclick="nav(0)"><i class="material-icons-round">grid_view</i>Home</div>
    <div class="nav-item" onclick="nav(1)"><i class="material-icons-round">add_circle</i>Entry</div>
    <div class="nav-item" onclick="nav(2)"><i class="material-icons-round">sync_alt</i>Transfer</div>
    <div class="nav-item" onclick="nav(3)"><i class="material-icons-round">receipt_long</i>Bills</div>
  </div>

  <script>
    const API = "https://script.google.com/macros/s/AKfycbxrJAGCqDJLvZSPPdJTVhyNk1g06-cdom4dAxZE4I6L6BYMY7wKCf_mFXL1aWs4l-RpwA/exec"; // <--- ‡§Ö‡§™‡§®‡§æ ‡§≤‡§ø‡§Ç‡§ï ‡§Ø‡§π‡§æ‡§Å ‡§°‡§æ‡§≤‡•á‡§Ç
    let db = null;

    function nav(idx) {
      document.querySelectorAll('.page').forEach((p, i) => p.classList.toggle('active', i === idx));
      document.querySelectorAll('.nav-item').forEach((n, i) => n.classList.toggle('active', i === idx));
      if(idx === 0) loadData();
    }

    async function loadData() {
      try {
        let res = await fetch(API, {method:"POST", body: JSON.stringify({action:"getDashboard"})}).then(r=>r.json());
        if(res.ok) {
          db = res;
          document.getElementById('h-today').innerText = "‚Çπ" + res.summary.todayExp;
          document.getElementById('h-month').innerText = "‚Çπ" + res.summary.monthExp;
          document.getElementById('h-funds').innerText = "‚Çπ" + res.summary.monthFund;
          const w = res.banks.find(b=>b.name=='Wallet');
          document.getElementById('h-wallet').innerText = "‚Çπ" + (w?w.val:0);
          
          document.getElementById('h-history').innerHTML = res.summary.recentTrans.map(t=>`
            <div class="row"><div><b>${t.name}</b><br><small style="color:#94a3b8">${t.date}</small></div>
            <b style="color:${t.amount<0?'#ef4444':'#10b981'}">${t.amount<0?'-':'+'}‚Çπ${Math.abs(t.amount)}</b></div>
          `).join("");

          document.getElementById('e-bank').innerHTML = res.banks.filter(b=>b.name!='Wallet').map(b=>`<option value="${b.name}">${b.name}</option>`).join("");
          document.getElementById('e-cat').innerHTML = res.categories.map(c=>`<option value="${c.name}">${c.name}</option>`).join("");
        }
      } catch(e) { alert("Load Failed"); }
    }

    function updateFundFields() {
      const to = document.getElementById('f-to').value;
      const bDiv = document.getElementById('f-bank-div');
      const src = document.getElementById('f-src');
      if(to === 'Wallet') {
        bDiv.style.display = 'none';
        src.innerHTML = '<option value="Others">Salary/Other</option>' + db.banks.filter(b=>b.name!='Wallet').map(b=>`<option value="${b.name}">${b.name}</option>`).join("");
      } else {
        bDiv.style.display = 'block';
        document.getElementById('f-bank').innerHTML = db.banks.filter(b=>b.name!='Wallet').map(b=>`<option value="${b.name}">${b.name}</option>`).join("");
        src.innerHTML = '<option value="Wallet">From Wallet</option>';
      }
    }

    async function save(type) {
      let p = { action: "save" };
      if(type === 'entry') {
        p.type = document.getElementById('e-mode').value;
        p.name = (p.type=='cash')?'Cash':document.getElementById('e-bank').value;
        p.amount = -Math.abs(document.getElementById('e-amt').value);
        p.category = document.getElementById('e-cat').value;
      } else {
        p.type = "Add Fund";
        p.amount = document.getElementById('f-amt').value;
        p.source = document.getElementById('f-src').value;
        p.name = (document.getElementById('f-to').value=='Wallet')?'Wallet':document.getElementById('f-bank').value;
      }
      
      const btn = event.target; btn.innerText = "Wait...";
      await fetch(API, {method:"POST", body: JSON.stringify(p)});
      alert("Recorded!");
      btn.innerText = "SUCCESS";
      nav(0);
    }

    window.onload = loadData;
  </script>
</body>
</html>
