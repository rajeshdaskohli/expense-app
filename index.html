<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@600;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  <style>
    :root { --bg: #0b1120; --card: #172033; --primary: #38bdf8; --text: #ffffff; }
    body { margin:0; background:var(--bg); color:var(--text); font-family: 'Plus Jakarta Sans', sans-serif; padding-bottom: 100px; }
    
    .header { padding: 25px 20px; display: flex; justify-content: space-between; align-items: center; background: rgba(11, 17, 32, 0.9); position: sticky; top: 0; z-index: 100; }
    .header h2 { margin:0; font-size: 18px; text-transform: uppercase; letter-spacing: 1px; }

    .page { display: none; padding: 0 20px; }
    .page.active { display: block; animation: slideUp 0.3s ease-out; }
    @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* Premium Cards */
    .hero-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 25px; }
    .stat-card { padding: 20px; border-radius: 24px; position: relative; overflow: hidden; }
    .stat-card h3 { margin:0; font-size: 10px; opacity: 0.8; text-transform: uppercase; }
    .stat-card h1 { margin: 8px 0 0; font-size: 22px; font-weight: 800; }

    .list-card { background: var(--card); border-radius: 28px; padding: 10px 15px; border: 1px solid rgba(255,255,255,0.05); margin-bottom: 20px; }
    .row { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
    .row:last-child { border: none; }

    /* Forms */
    .form-box { background: var(--card); padding: 20px; border-radius: 28px; border: 1px solid rgba(255,255,255,0.05); }
    .inp { width: 100%; background: #1e293b; border: 1px solid #334155; border-radius: 16px; padding: 16px; color: white; margin: 10px 0; font-size: 16px; box-sizing: border-box; }
    .btn { width: 100%; background: var(--primary); color: #000; border: none; padding: 18px; border-radius: 20px; font-weight: 800; font-size: 16px; margin-top: 15px; box-shadow: 0 10px 20px rgba(56,189,248,0.2); }

    /* Navigation */
    .nav-bar { position: fixed; bottom: 20px; left: 20px; right: 20px; background: rgba(30, 41, 59, 0.95); backdrop-filter: blur(10px); display: flex; border-radius: 24px; padding: 8px; border: 1px solid rgba(255,255,255,0.1); z-index: 1000; }
    .nav-item { flex: 1; text-align: center; color: #64748b; font-size: 10px; padding: 10px 0; border-radius: 18px; }
    .nav-item.active { color: var(--primary); background: rgba(56, 189, 248, 0.1); }
    .nav-item i { display: block; font-size: 24px; margin-bottom: 4px; }
  </style>
</head>
<body>

  <div class="header">
    <div><h2>Expense Seva Pro</h2><small style="color:#10b981">‚óè LIVE SYSTEM</small></div>
    <i class="material-icons-round" onclick="refreshData()" style="color:var(--primary)">sync</i>
  </div>

  <div id="page-home" class="page active">
    <div class="hero-grid">
      <div class="stat-card" style="background:linear-gradient(135deg, #f59e0b, #d97706)"><h3>Today</h3><h1 id="d-today">‚Çπ0</h1></div>
      <div class="stat-card" style="background:linear-gradient(135deg, #ec4899, #be185d)"><h3>Month Exp</h3><h1 id="d-month">‚Çπ0</h1></div>
      <div class="stat-card" style="background:linear-gradient(135deg, #10b981, #059669)"><h3>Total Funds</h3><h1 id="d-funds">‚Çπ0</h1></div>
      <div class="stat-card" style="background:linear-gradient(135deg, #3b82f6, #2563eb)"><h3>Wallet Bal</h3><h1 id="d-wallet">‚Çπ0</h1></div>
    </div>
    <div style="font-size:11px; color:#64748b; margin-bottom:12px; font-weight:800">RECENT ACTIVITY</div>
    <div class="list-card" id="h-history"></div>
  </div>

  <div id="page-entry" class="page">
    <div class="form-box">
      <h3 style="margin-top:0">Add Expense</h3>
      <select id="e-mode" class="inp" onchange="toggleEntryBank()">
        <option value="cash">üíµ Cash</option>
        <option value="bank">üè¶ Bank Transfer</option>
      </select>
      <div id="e-bank-div" style="display:none"><select id="e-bank" class="inp"></select></div>
      <select id="e-cat" class="inp"></select>
      <input type="number" id="e-amt" class="inp" placeholder="0.00">
      <button class="btn" onclick="saveData('entry')">RECORD EXPENSE</button>
    </div>
  </div>

  <div id="page-fund" class="page">
    <div class="form-box">
      <h3 style="margin-top:0">Money Transfer</h3>
      <label style="font-size:11px; color:var(--primary); font-weight:800">DEPOSIT TO</label>
      <select id="f-to" class="inp" onchange="updateFundLogic()">
        <option value="Wallet">Wallet</option>
        <option value="Bank">Bank Account</option>
      </select>
      <div id="f-bank-div" style="display:none"><select id="f-bank" class="inp"></select></div>
      <label style="font-size:11px; color:var(--primary); font-weight:800; margin-top:15px; display:block">SOURCE (FROM)</label>
      <select id="f-src" class="inp"></select>
      <input type="number" id="f-amt" class="inp" placeholder="0.00">
      <button class="btn" onclick="saveData('fund')">CONFIRM TRANSFER</button>
    </div>
  </div>

  <div class="nav-bar">
    <div class="nav-item active" onclick="nav(0)"><i class="material-icons-round">grid_view</i>Home</div>
    <div class="nav-item" onclick="nav(1)"><i class="material-icons-round">add_circle</i>Entry</div>
    <div class="nav-item" onclick="nav(2)"><i class="material-icons-round">sync_alt</i>Transfer</div>
    <div class="nav-item" onclick="nav(3)"><i class="material-icons-round">receipt_long</i>Bills</div>
  </div>

  <script>
    const SCRIPT_URL = "‡§Ü‡§™‡§ï‡§æ_APPS_SCRIPT_URL_‡§Ø‡§π‡§æ‡§Å"; // <--- ‡§Ö‡§™‡§®‡§æ URL ‡§Ø‡§π‡§æ‡§Å ‡§°‡§æ‡§≤‡•á‡§Ç
    let database = null;

    function nav(idx) {
      const pages = ['page-home', 'page-entry', 'page-fund', 'page-home']; // 4th for Bills
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      
      const targetPage = document.getElementById(pages[idx]);
      if(targetPage) targetPage.classList.add('active');
      document.querySelectorAll('.nav-item')[idx].classList.add('active');

      if(idx === 0) refreshData();
      if(idx === 2) updateFundLogic();
    }

    async function refreshData() {
      try {
        let res = await fetch(SCRIPT_URL, {method:"POST", body: JSON.stringify({action:"getDashboard"})}).then(r=>r.json());
        if(res.ok) {
          database = res;
          document.getElementById('d-today').innerText = "‚Çπ" + res.summary.todayExp;
          document.getElementById('d-month').innerText = "‚Çπ" + res.summary.monthExp;
          document.getElementById('d-funds').innerText = "‚Çπ" + res.summary.monthFund;
          const wallet = res.banks.find(b=>b.name=='Wallet');
          document.getElementById('d-wallet').innerText = "‚Çπ" + (wallet ? wallet.val : 0);
          
          document.getElementById('h-history').innerHTML = res.summary.recentTrans.map(t=>`
            <div class="row"><div><b>${t.name}</b><br><small style="color:#64748b">${t.date}</small></div>
            <b style="color:${t.amount < 0 ? '#ef4444' : '#10b981'}">${t.amount < 0 ? '-' : '+'}‚Çπ${Math.abs(t.amount)}</b></div>
          `).join("");

          document.getElementById('e-bank').innerHTML = res.banks.filter(b=>b.name!='Wallet').map(b=>`<option value="${b.name}">${b.name}</option>`).join("");
          document.getElementById('e-cat').innerHTML = res.categories.map(c=>`<option value="${c.name}">${c.name}</option>`).join("");
        }
      } catch(e) { console.error(e); }
    }

    function toggleEntryBank() {
      document.getElementById('e-bank-div').style.display = (document.getElementById('e-mode').value === 'bank' ? 'block' : 'none');
    }

    function updateFundLogic() {
      if(!database) return;
      const to = document.getElementById('f-to').value;
      const bDiv = document.getElementById('f-bank-div');
      const srcSelect = document.getElementById('f-src');
      
      if(to === 'Wallet') {
        bDiv.style.display = 'none';
        srcSelect.innerHTML = '<option value="Others">Salary / External</option>' + 
          database.banks.filter(b=>b.name!='Wallet').map(b=>`<option value="${b.name}">${b.name}</option>`).join("");
      } else {
        bDiv.style.display = 'block';
        document.getElementById('f-bank').innerHTML = database.banks.filter(b=>b.name!='Wallet').map(b=>`<option value="${b.name}">${b.name}</option>`).join("");
        srcSelect.innerHTML = '<option value="Wallet">From Wallet</option>';
      }
    }

    async function saveData(type) {
      const btn = event.target;
      btn.innerText = "Saving...";
      btn.disabled = true;

      let payload = { action: "save" };
      if(type === 'entry') {
        payload.type = document.getElementById('e-mode').value;
        payload.name = (payload.type === 'cash') ? 'Cash' : document.getElementById('e-bank').value;
        payload.amount = -Math.abs(document.getElementById('e-amt').value);
        payload.category = document.getElementById('e-cat').value;
      } else {
        payload.type = "Add Fund";
        payload.amount = document.getElementById('f-amt').value;
        payload.source = document.getElementById('f-src').value;
        payload.name = (document.getElementById('f-to').value === 'Wallet') ? 'Wallet' : document.getElementById('f-bank').value;
      }

      await fetch(SCRIPT_URL, {method:"POST", body: JSON.stringify(payload)});
      alert("Recorded Successfully!");
      btn.innerText = "Recorded!";
      btn.disabled = false;
      nav(0);
    }

    window.onload = refreshData;
  </script>
</body>
</html>
