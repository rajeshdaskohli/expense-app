<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <meta name="theme-color" content="#0f172a">
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  <style>
    :root {
      --bg: #0f172a; --card: #1e293b; --primary: #38bdf8;
      --text: #f8fafc; --text-dim: #94a3b8;
      --green: #10b981; --red: #ef4444;
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { 
      margin: 0; background: var(--bg); color: var(--text); 
      font-family: 'Plus Jakarta Sans', sans-serif; padding-bottom: 100px; 
    }
    
    .header {
      background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(10px);
      padding: 24px 20px; display: flex; align-items: center;
      justify-content: space-between; position: sticky; top: 0; z-index: 100;
    }
    .header h1 { margin: 0; font-size: 20px; font-weight: 800; letter-spacing: -1px; }
    .header .status-dot { height: 8px; width: 8px; background: var(--green); border-radius: 50%; display: inline-block; margin-right: 5px; box-shadow: 0 0 10px var(--green); }

    .container { max-width: 500px; margin: 0 auto; padding: 0 16px; }

    .page { display: none; animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
    .page.active { display: block; }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    /* Hero Stats Section */
    .hero-scroll { display: flex; overflow-x: auto; gap: 12px; padding-bottom: 10px; scrollbar-width: none; }
    .hero-scroll::-webkit-scrollbar { display: none; }
    .hero-card {
      min-width: 160px; background: linear-gradient(145deg, #1e293b, #0f172a);
      padding: 20px; border-radius: 28px; border: 1px solid rgba(255,255,255,0.05);
      position: relative; overflow: hidden;
    }
    .hero-card::after { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(56,189,248,0.05) 0%, transparent 70%); }
    .hero-card span { font-size: 11px; color: var(--text-dim); font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
    .hero-card p { margin: 8px 0 0; font-size: 18px; font-weight: 800; }

    /* Category Grid (3 Column) */
    .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 15px 0; }
    .cat-pill {
      background: var(--card); padding: 15px 10px; border-radius: 20px; text-align: center;
      border: 1px solid rgba(255,255,255,0.03);
    }
    .cat-pill small { color: var(--text-dim); font-size: 10px; display: block; margin-bottom: 5px; font-weight: 600; }
    .cat-pill b { font-size: 12px; color: var(--primary); }

    /* Section Titles */
    .label-row { display: flex; justify-content: space-between; align-items: center; margin: 25px 0 15px; }
    .label-row h3 { font-size: 14px; font-weight: 800; color: var(--text-dim); margin: 0; letter-spacing: 1px; }

    /* List Cards */
    .list-container { background: var(--card); border-radius: 32px; padding: 10px 20px; border: 1px solid rgba(255,255,255,0.03); }
    .row { display: flex; justify-content: space-between; align-items: center; padding: 18px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
    .row:last-child { border: none; }
    .row .icon-box { height: 44px; width: 44px; background: rgba(255,255,255,0.03); border-radius: 14px; display: flex; align-items: center; justify-content: center; margin-right: 15px; }
    .row .meta b { display: block; font-size: 14px; margin-bottom: 2px; }
    .row .meta small { color: var(--text-dim); font-size: 11px; }
    .row .amt { font-weight: 800; font-size: 15px; text-align: right; }

    /* Bottom Nav (Premium Floating) */
    .nav-wrapper { position: fixed; bottom: 20px; left: 0; right: 0; display: flex; justify-content: center; z-index: 1000; }
    .nav-bar {
      background: rgba(30, 41, 59, 0.9); backdrop-filter: blur(20px);
      display: flex; padding: 8px; border-radius: 24px; border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 10px 40px rgba(0,0,0,0.5); width: 90%; max-width: 400px;
    }
    .nav-item { flex: 1; padding: 12px; border-radius: 18px; display: flex; flex-direction: column; align-items: center; gap: 4px; color: var(--text-dim); transition: 0.3s; }
    .nav-item.active { background: var(--primary); color: var(--bg); }
    .nav-item i { font-size: 22px; }
    .nav-item span { font-size: 10px; font-weight: 800; }

    /* Form Styles */
    .input-card { background: var(--card); border-radius: 28px; padding: 24px; margin-bottom: 20px; }
    .field { margin-bottom: 20px; }
    .field label { display: block; font-size: 11px; font-weight: 800; color: var(--primary); margin-bottom: 8px; text-transform: uppercase; }
    .inp {
      width: 100%; background: rgba(255,255,255,0.03); border: 1.5px solid rgba(255,255,255,0.05);
      border-radius: 16px; padding: 15px; color: #fff; font-size: 15px; outline: none; transition: 0.3s;
    }
    .inp:focus { border-color: var(--primary); background: rgba(56,189,248,0.05); }
    .btn-main {
      width: 100%; background: var(--primary); color: var(--bg); border: none;
      padding: 18px; border-radius: 20px; font-size: 16px; font-weight: 800; cursor: pointer;
      box-shadow: 0 10px 20px rgba(56,189,248,0.2);
    }

    /* Colors */
    .val-pos { color: var(--green); }
    .val-neg { color: var(--red); }
    .tag-status { padding: 4px 10px; border-radius: 10px; font-size: 10px; font-weight: 800; }
  </style>
</head>
<body>

  <div class="header">
    <div>
      <h1>EXPENSE SEVA</h1>
      <small><span class="status-dot"></span> LIVE SYSTEM</small>
    </div>
    <i class="material-icons-round" onclick="refreshData()" style="color:var(--primary); cursor:pointer;">sync</i>
  </div>

  <div class="container">
    
    <div class="page active" id="pageDashboard">
      <div class="hero-scroll">
        <div class="hero-card"><span>Today Exp</span><p id="sumToday">‚Çπ0</p></div>
        <div class="hero-card"><span>Monthly Total</span><p id="sumMonth">‚Çπ0</p></div>
        <div class="hero-card"><span>Total Fund</span><p id="sumFund">‚Çπ0</p></div>
      </div>

      <div class="label-row"><h3>CATEGORY SUMMARY</h3></div>
      <div class="grid-3" id="catSummaryGrid"></div>

      <div class="label-row">
        <h3>BANKS</h3>
        <span id="bankSubtotal" style="font-size:12px; font-weight:800;">‚Çπ0</span>
      </div>
      <div class="list-container" id="bankList"></div>

      <div class="label-row"><h3>CREDIT CARDS</h3></div>
      <div class="list-container" id="cardList"></div>

      <div class="label-row"><h3>LOANS & EMI</h3></div>
      <div class="list-container" id="loanList"></div>

      <div class="label-row"><h3>1 MONTH ACTIVITY</h3></div>
      <div class="list-container" id="historyList"></div>
    </div>

    <div class="page" id="pageEntry">
      <div class="input-card">
        <div class="field">
          <label>Mode</label>
          <select class="inp" id="payMode" onchange="toggleFields()">
            <option value="cash">üíµ Cash</option>
            <option value="bank">üè¶ Bank Transfer</option>
            <option value="card">üí≥ Credit Card</option>
          </select>
        </div>
        <div id="divBank" style="display:none;" class="field"><label>Select Bank</label><select class="inp" id="expBank"></select></div>
        <div id="divCard" style="display:none;" class="field"><label>Select Card</label><select class="inp" id="expCard"></select></div>
        <div class="field"><label>Category</label><select class="inp" id="expCategory"></select></div>
        <div class="field"><label>Amount</label><input type="number" class="inp" id="expAmount" placeholder="0.00"></div>
        <div class="field"><label>Remark</label><input type="text" class="inp" id="expRemark" placeholder="Optional"></div>
        <button class="btn-main" onclick="saveTrans('entry')">RECORD EXPENSE</button>
      </div>
    </div>

    <div class="page" id="pageAddfund">
      <div class="input-card">
        <div class="field"><label>Target Bank</label><select class="inp" id="targetBank"></select></div>
        <div class="field"><label>Amount</label><input type="number" class="inp" id="fundAmount" placeholder="0.00"></div>
        <button class="btn-main" onclick="saveTrans('fund')">DEPOSIT FUNDS</button>
      </div>
    </div>

    <div class="page" id="pagePayments">
      <div class="input-card">
        <div class="field"><label>From Bank</label><select class="inp" id="payFrom"></select></div>
        <div class="field"><label>To (Card/Loan)</label><select class="inp" id="payTo"></select></div>
        <div class="field"><label>Amount</label><input type="number" class="inp" id="payAmt" placeholder="0.00"></div>
        <button class="btn-main" onclick="saveTrans('pay')">PROCESS PAYMENT</button>
      </div>
    </div>

  </div>

  <div class="nav-wrapper">
    <div class="nav-bar">
      <div class="nav-item active" onclick="showPage('dashboard')">
        <i class="material-icons-round">grid_view</i><span>Home</span>
      </div>
      <div class="nav-item" onclick="showPage('entry')">
        <i class="material-icons-round">add_box</i><span>Entry</span>
      </div>
      <div class="nav-item" onclick="showPage('addfund')">
        <i class="material-icons-round">account_balance_wallet</i><span>Fund</span>
      </div>
      <div class="nav-item" onclick="showPage('payments')">
        <i class="material-icons-round">receipt_long</i><span>Bills</span>
      </div>
    </div>
  </div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbwskBBKpZQdd_A1wgo3L75Bvh-c8JFa0ioxv-eAf-C-ItN78jKpK2AfRshhG0iGPicU/exec"; 
    let db = null;

    // ‡§ï‡§∞‡§Ç‡§∏‡•Ä ‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü‡§ø‡§Ç‡§ó (‚Çπ)
    const fmt = (n) => new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR' }).format(Number(n) || 0);

    async function showPage(name) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      
      const page = document.getElementById('page' + name.charAt(0).toUpperCase() + name.slice(1));
      page.classList.add('active');
      
      const navItems = document.querySelectorAll('.nav-item');
      if(name === 'dashboard') navItems[0].classList.add('active');
      else if(name === 'entry') navItems[1].classList.add('active');
      else if(name === 'addfund') navItems[2].classList.add('active');
      else if(name === 'payments') navItems[3].classList.add('active');

      if(name !== 'home') await refreshData();
    }

    async function refreshData() {
      try {
        const res = await fetch(API_URL, { method: "POST", body: JSON.stringify({action: "getDashboard"}) }).then(r => r.json());
        if(res.ok) { db = res; updateUI(); }
      } catch(e) { console.error("Data Error:", e); }
    }

    function updateUI() {
      const s = db.summary;
      document.getElementById("sumToday").innerText = fmt(s.todayExp);
      document.getElementById("sumMonth").innerText = fmt(s.monthExp);
      document.getElementById("sumFund").innerText = fmt(s.monthFund);

      // Category Grid
      document.getElementById("catSummaryGrid").innerHTML = Object.entries(s.catTotals).map(([cat, val]) => `
        <div class="cat-pill"><small>${cat}</small><b>${fmt(val)}</b></div>`).join("");

      // 1. Bank List (Red if minus)
      let bSum = 0;
      document.getElementById("bankList").innerHTML = db.banks.map(b => { 
        bSum += b.val;
        let colorClass = b.val < 0 ? 'val-neg' : 'val-pos';
        return `
        <div class="row">
          <div style="display:flex; align-items:center;">
            <div class="icon-box"><i class="material-icons-round" style="color:var(--primary)">account_balance</i></div>
            <div class="meta"><b>${b.name}</b><small>Current Balance</small></div>
          </div>
          <div class="amt ${colorClass}">${fmt(b.val)}</div>
        </div>` }).join("");
      document.getElementById("bankSubtotal").innerText = fmt(bSum);
      document.getElementById("bankSubtotal").className = bSum < 0 ? 'val-neg' : 'val-pos';

      // 2. Credit Card List (Green if Zero)
      document.getElementById("cardList").innerHTML = db.cards.map(c => { 
        let colorClass = c.val == 0 ? 'val-pos' : 'val-neg';
        return `
        <div class="row">
          <div style="display:flex; align-items:center;">
            <div class="icon-box"><i class="material-icons-round" style="color:#a855f7">credit_card</i></div>
            <div class="meta"><b>${c.name}</b><small>Total Bill Due</small></div>
          </div>
          <div class="amt ${colorClass}">${fmt(c.val)}</div>
        </div>` }).join("");

      // 3. Loans
      document.getElementById("loanList").innerHTML = db.loans.map(l => `
        <div class="row">
          <div class="meta"><b>${l.name}</b><small>EMI: ${fmt(l.emi)}</small></div>
          <span class="tag-status ${l.status.toLowerCase()==='paid'?'tag-paid':'tag-unpaid'}" 
                style="background:${l.status.toLowerCase()==='paid'?'rgba(16,185,129,0.1)':'rgba(239,68,68,0.1)'}; color:${l.status.toLowerCase()==='paid'?'var(--green)':'var(--red)'}">
            ${l.status}
          </span>
        </div>`).join("");

      // 4. History (1 Month with Minus Sign)
      document.getElementById("historyList").innerHTML = s.recentTrans.map(t => {
        let isExp = t.type !== 'Add Fund';
        let prefix = isExp ? "-" : "+";
        let color = isExp ? "val-neg" : "val-pos";
        return `
        <div class="row">
          <div class="meta"><b>${t.name}</b><small>${t.date} ‚Ä¢ ${t.category}</small></div>
          <div class="amt ${color}">${prefix}${fmt(t.amount)}</div>
        </div>` }).join("");

      fillDropdowns();
    }

    function fillDropdowns() {
      const opt = (list, key) => list.map(i => `<option value="${i[key]}">${i[key]}</option>`).join("");
      document.getElementById("expBank").innerHTML = opt(db.banks, "name");
      document.getElementById("targetBank").innerHTML = opt(db.banks, "name");
      document.getElementById("payFrom").innerHTML = opt(db.banks, "name");
      document.getElementById("expCard").innerHTML = opt(db.cards, "name");
      document.getElementById("payTo").innerHTML = opt(db.cards, "name") + opt(db.loans, "name");
      document.getElementById("expCategory").innerHTML = db.categories.map(c => `<option value="${c}">${c}</option>`).join("");
    }

    async function saveTrans(type) {
      let p = { action: "save" };
      if(type==='entry') {
        let m = document.getElementById("payMode").value;
        p.type = m; p.name = (m==='cash')?'Cash':(m==='bank')?document.getElementById("expBank").value:document.getElementById("expCard").value;
        p.amount = document.getElementById("expAmount").value; p.category = document.getElementById("expCategory").value; p.remark = document.getElementById("expRemark").value;
      } else if(type==='fund') {
        p.type="Add Fund"; p.name=document.getElementById("targetBank").value; p.amount=document.getElementById("fundAmount").value;
      } else if(type==='pay') {
        p.type="Bill Pay"; p.name=document.getElementById("payTo").value; p.amount=document.getElementById("payAmt").value; p.remark="From "+document.getElementById("payFrom").value;
      }
      if(!p.amount || !p.name) return alert("Fill Details!");
      
      const res = await fetch(API_URL, { method: "POST", body: JSON.stringify(p) }).then(r=>r.json());
      if(res.ok) { alert("Successfully Recorded!"); showPage("dashboard"); }
    }

    function toggleFields() {
      const m = document.getElementById("payMode").value;
      document.getElementById("divBank").style.display = (m==='bank') ? 'block' : 'none';
      document.getElementById("divCard").style.display = (m==='card') ? 'block' : 'none';
    }

    window.onload = () => showPage('dashboard');
  </script>
</body>
</html>
