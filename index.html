<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Expense Manager</title>
  <style>
    /* ‡§™‡•Å‡§∞‡§æ‡§®‡•á ‡§ï‡•ã‡§° ‡§µ‡§æ‡§≤‡§æ CSS ‡§Ø‡§π‡§æ‡§Å ‡§∞‡§π‡•á‡§ó‡§æ (‡§°‡§ø‡§ú‡§æ‡§á‡§® ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§¨‡§¶‡§≤‡§æ‡§µ ‡§®‡§π‡•Ä‡§Ç) */
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
    body{margin:0;font-family:Arial,sans-serif;background:#f4f4f4;color:#111;}
    .topbar{background:#111;color:#fff;padding:14px;display:flex;align-items:center;gap:12px;position:sticky;top:0;z-index:1000;}
    .menuBtn{width:44px;height:44px;border:none;background:transparent;color:#fff;font-size:22px;cursor:pointer;}
    .container{max-width:540px;margin:0 auto;padding:18px;}
    .page{display:none;} .page.active{display:block;}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
    .card{background:#fff;border-radius:20px;padding:12px;height:120px;border:1.5px solid rgba(0,0,0,0.18);text-align:center;display:flex;flex-direction:column;justify-content:center;cursor:pointer;}
    .cardIcon{font-size:28px;margin-bottom:10px;}
    .box{background:#fff;border-radius:18px;padding:16px;border:1px solid rgba(0,0,0,0.10);margin-bottom:16px;}
    .field{margin-bottom:14px;} .lbl{display:block;font-size:15px;font-weight:900;margin-bottom:8px;}
    .inp{width:100%;height:54px;padding:0 14px;border-radius:14px;border:1px solid #d8d8d8;font-size:16px;}
    .sel{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%23999' d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center;}
    .btn{height:56px;border:none;border-radius:16px;font-size:18px;font-weight:900;cursor:pointer;width:100%;}
    .btnBlack{background:#111;color:#fff;}
    .toast{position:fixed;left:50%;bottom:22px;transform:translateX(-50%);background:#111;color:#fff;padding:12px 14px;border-radius:16px;display:none;z-index:5000;}
    .statRow{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #eee;}
    .val-pos{color:green;font-weight:900;} .val-neg{color:red;font-weight:900;}
  </style>
</head>
<body>

  <div class="topbar">
    <button class="menuBtn" id="leftBtn">‚ò∞</button>
    <div style="display:flex;flex-direction:column;">
      <b id="pageTitle">Home</b>
      <small id="pageSub">EXPENSE MANAGER</small>
    </div>
  </div>

  <div class="container">
    <div class="page active" id="pageHome">
      <div class="grid2">
        <div class="card" onclick="showPage('expense')">
          <div class="cardIcon">üí∞</div><b>Expense Seva</b>
        </div>
      </div>
    </div>

    <div class="page" id="pageExpense">
      <div class="grid2">
        <div class="card" onclick="showPage('dashboard')"><div class="cardIcon">üìä</div>Dashboard</div>
        <div class="card" onclick="showPage('entry')"><div class="cardIcon">‚úçÔ∏è</div>Expense Entry</div>
        <div class="card" onclick="showPage('addfund')"><div class="cardIcon">üè¶</div>Add Fund</div>
      </div>
    </div>

    <div class="page" id="pageDashboard">
      <div class="box"><h3>üè¶ Banks</h3><div id="bankList">Loading...</div></div>
      <div class="box"><h3>üí≥ Cards</h3><div id="cardList">Loading...</div></div>
      <div class="box"><h3>üìâ Loans</h3><div id="loanList">Loading...</div></div>
    </div>

    <div class="page" id="pageEntry">
      <div class="box">
        <div class="field"><label class="lbl">Source</label><select class="inp sel" id="expSource"></select></div>
        <div class="field"><label class="lbl">Amount</label><input type="number" class="inp" id="expAmount"></div>
        <button class="btn btnBlack" onclick="saveExpense()">Submit</button>
      </div>
    </div>

    <div class="page" id="pageAddfund">
      <div class="box">
        <div class="field"><label class="lbl">Action</label>
          <select class="inp sel" id="fundAction" onchange="toggleFundFields()">
            <option value="">-- Select --</option>
            <option value="add">Add Fund</option>
            <option value="cc">Pay Credit Card Bill</option>
            <option value="emi">Pay EMI</option>
          </select>
        </div>
        <div id="fieldBank" style="display:none;" class="field"><label class="lbl">Bank</label><select class="inp sel" id="targetBank"></select></div>
        <div id="fieldCC" style="display:none;" class="field"><label class="lbl">Card</label><select class="inp sel" id="targetCC"></select></div>
        <div id="fieldEMI" style="display:none;" class="field"><label class="lbl">Loan</label><select class="inp sel" id="targetLoan"></select></div>
        <div id="fieldAmt" style="display:none;" class="field"><label class="lbl">Amount</label><input type="number" class="inp" id="fundAmount"></div>
        <button class="btn btnBlack" id="fundBtn" style="display:none;" onclick="processFund()">Submit</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // --- ‡§Ø‡§π‡§æ‡§Å ‡§Ö‡§™‡§®‡•Ä Google Script URL ‡§°‡§æ‡§≤‡•á‡§Ç ---
    const API_URL = "‡§Ø‡§π‡§æ‡§Å_‡§Ö‡§™‡§®‡•Ä_URL_‡§™‡•á‡§∏‡•ç‡§ü_‡§ï‡§∞‡•á‡§Ç";

    let db = { banks: [], cards: [], loans: [] };

    async function apiPost(payload) {
      const res = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "text/plain;charset=utf-8" },
        body: JSON.stringify(payload)
      });
      return await res.json();
    }

    function showToast(msg) {
      const t = document.getElementById("toast");
      t.textContent = msg; t.style.display = "block";
      setTimeout(() => t.style.display = "none", 2000);
    }

    async function fetchDashboard() {
      showToast("Loading Data...");
      try {
        const res = await apiPost({ action: "getDashboard" });
        if(res.ok) {
          db.banks = res.banks; db.cards = res.cards; db.loans = res.loans;
          renderDashboard();
          updateDropdowns();
        }
      } catch(e) { showToast("Sync Error"); }
    }

    function renderDashboard() {
      document.getElementById("bankList").innerHTML = db.banks.map(b => `<div class="statRow"><span>${b.name}</span><span class="val-pos">‚Çπ${b.balance}</span></div>`).join("");
      document.getElementById("cardList").innerHTML = db.cards.map(c => `<div class="statRow"><span>${c.name}</span><span class="val-neg">‚Çπ${c.due}</span></div>`).join("");
      document.getElementById("loanList").innerHTML = db.loans.map(l => `<div class="statRow"><span>${l.name}</span><span class="val-neg">‚Çπ${l.emi} [${l.status}]</span></div>`).join("");
    }

    function updateDropdowns() {
      const bOpt = db.banks.map(b => `<option value="${b.name}">${b.name}</option>`).join("");
      const cOpt = db.cards.map(c => `<option value="${c.name}">${c.name}</option>`).join("");
      const lOpt = db.loans.map(l => `<option value="${l.name}">${l.name}</option>`).join("");
      
      document.getElementById("expSource").innerHTML = bOpt + cOpt;
      document.getElementById("targetBank").innerHTML = bOpt;
      document.getElementById("targetCC").innerHTML = cOpt;
      document.getElementById("targetLoan").innerHTML = lOpt;
    }

    async function saveExpense() {
      const source = document.getElementById("expSource").value;
      const amt = parseFloat(document.getElementById("expAmount").value);
      if(!amt) return showToast("Enter Amount");
      
      const isCard = db.cards.some(c => c.name === source);
      showToast("Saving...");
      const res = await apiPost({ 
        action: "save", 
        name: source, 
        amount: amt, 
        type: isCard ? "card" : "bank" 
      });
      if(res.ok) { showToast("Saved ‚úÖ"); fetchDashboard(); }
    }

    async function processFund() {
      const act = document.getElementById("fundAction").value;
      const amt = parseFloat(document.getElementById("fundAmount").value);
      const bank = document.getElementById("targetBank").value;
      
      let payload = { action: "processFund", fundAction: act, amount: amt, bankName: bank };
      if(act==='cc') payload.ccName = document.getElementById("targetCC").value;
      if(act==='emi') payload.loanName = document.getElementById("targetLoan").value;

      showToast("Updating...");
      const res = await apiPost(payload);
      if(res.ok) { showToast("Success ‚úÖ"); fetchDashboard(); }
    }

    function toggleFundFields() {
      const act = document.getElementById("fundAction").value;
      document.getElementById("fieldBank").style.display = act ? "block" : "none";
      document.getElementById("fieldCC").style.display = (act==='cc') ? "block" : "none";
      document.getElementById("fieldEMI").style.display = (act==='emi') ? "block" : "none";
      document.getElementById("fieldAmt").style.display = act ? "block" : "none";
      document.getElementById("fundBtn").style.display = act ? "block" : "none";
    }

    function showPage(name) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById('page' + name.charAt(0).toUpperCase() + name.slice(1)).classList.add('active');
      if(name === 'dashboard' || name === 'entry' || name === 'addfund') fetchDashboard();
    }

    document.getElementById("leftBtn").onclick = () => showPage('home');
  </script>
</body>
</html>
